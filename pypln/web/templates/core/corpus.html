{% extends "site_base.html" %}
{% load i18n %}
{% load ifsetting_tag %}
{% block head_title %}{% trans "Corpus" %} {{ corpus.slug }}{% endblock %}
{% block extra_head %}
{% endblock %}

{% block body %}
<div class="breadcrumb">
{% trans "You are here:" %}
    <a href="{% url home %}">{% trans "Home" %}</a> &gt;
    <a href="{% url corpora_list %}">Corpora</a> &gt;
    <a href="{% url corpus_page corpus.slug %}">Corpus {{ corpus.name }}</a>
  </div>

  <h2 class="brand">{% trans "Corpus" %} {{ corpus.name }}</h2>
  <p class="description"> {{ corpus.description }} </p>
    <div class="row">
      <div class="span8">
        <div>
          <h3>{% trans "Add a document" %}</h3>
            <form class="well form-inline" method="POST"
              action="{% url corpus_page corpus.slug %}" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form }}
            <input type="submit" value="Add" class="btn" />
          </form>
        </div>
        <div>
          <h3>{% trans "Search this corpus" %}</h3>
          <form method="GET" action="{% url search %}">
            <input type="hidden" name="corpus" value="{{ corpus.slug }}">
            <input type="text" name="query" />
            <input type="submit" value="Search" />
          </form>
        </div>
        </div>
        <div class="span8">
          <h3>{% trans "Metadata" %}</h3>
          <div>
            <span class="label label-info">
              {% trans "Owner:" %}
            </span>
            <span class="label">
              <a href="{% url profile_detail username=corpus.owner.username %}">{{ corpus.owner }}</a>
            </span>
          </div>
          <div>
            <span class="label label-info">
              {% trans "Number of documents:" %}
            </span>
            <span class="label">
              {{ corpus.documents.count }}
            </span>
          </div>
          <div>
            <span class="label label-info">
              {% trans "Date of creation:" %}
            </span>
            <span class="label">
              {{ corpus.date_created }}
            </span>
          </div>
          <div>
            <span class="label label-info">
              {% trans "Last modified on:" %}
            </span>
            <span class="label">
              {{ corpus.last_modified }}
            </span>
          </div>
        </div>
    </div>
    <h3>{% trans "List of Documents" %}</h3>
    <div class="per-page">{% trans "Show" %}
        <select id="per-page">
            <option {% if documents.paginator.per_page == 10 %}selected{% endif %} value="10">10</option>
            <option {% if documents.paginator.per_page == 25 %}selected{% endif %} value="25">25</option>
            <option {% if documents.paginator.per_page == 50 %}selected{% endif %} value="50">50</option>
            <option {% if documents.paginator.per_page == 100 %}selected{% endif %} value="100">100</option>
        </select>
        {% trans "entries" %}
    </div>
    <table id="table_documents">
        <thead>
        <tr>
            <th class="sort{% if sort_by == "blob" %} sort_asc{% endif %}{% if sort_by == "-blob" %} sort_desc{% endif %}" key="filename">{% trans "Filename" %}</th>
            <th>{% trans "Size" %}</th>
            <th class="sort{% if sort_by == "date_uploaded" %} sort_asc{% endif %}{% if sort_by == "-date_uploaded" %} sort_desc{% endif %}" key="date">{% trans "Uploaded on" %}</th>
            <th>{% trans "Owner" %}</th>
        </tr>
        </thead>
        <tbody>
        {% for document in documents.object_list %}
        <tr>
          <td><a href="{% url document_page document.id document.slug %}">{{ document.file_name }}</a></td>
          <td>{{ document.file_size }}</td>
          <td>{{ document.date_uploaded }}</td>
          <td><a href="{% url profile_detail username=document.owner.username %}">{{ document.owner }}</a></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="pagination pagination-right pagination-small">
        <ul>
            {% if documents.has_previous %}
                <li><a href="?page={{ documents.previous_page_number }}&per_page={{ documents.paginator.per_page }}">{% trans "previous" %}</a></li>
            {% else %}
                <li class="disabled"><span>{% trans "previous"%}</span></li>
            {% endif %}
            {% if documents.has_next %}
                <li><a href="?page={{ documents.next_page_number }}&per_page={{ documents.paginator.per_page }}">{% trans "next" %}</a></li>
            {% else %}
                <li class="disabled"><span>{% trans "next"%}</span></li>
            {% endif %}
        </ul>
    </div>
{% endblock %}
{% block extra_body %}
    <script type="text/javascript">
        function getURLParams() {
            var querystring = window.location.search.split('?')[1];
            var params = {}
            if (querystring != undefined){
                $(querystring.split('&')).each(function(idx, el){
                    var key_value = el.split('=');
                    var value = key_value[0];
                    if (key_value[1] != undefined) {
                        var key = key_value[1];
                    } else {
                        var key = true;
                    }
                    params[value] = key;
                })
            }
            return params;
        }
        $('#per-page').change(function(ev){
            window.location = "?per_page=" + ev.target.value;
        });

        $('.sort').click(function(ev) {
            var params = getURLParams();
            var element = ev.target;
            params['sort_by'] = element.getAttribute('key');
            if (element.classList.contains('sort_asc')) {
                params['sort_by'] = params.sort_by + "_desc";
            }
            // If you change the sort param, you probably want to be on the
            // first page.
            delete params.page;
            window.location = "?" + $.param(params);
        });
    </script>
{% endblock %}
